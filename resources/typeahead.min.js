/* Typeahead search v0.1.0 */
(function(root){function Builder(){this.version="0.1.0";this.init=function(el,opt){return new TA(el,opt)};return this}function TA(el,opt){if(!opt){opt={}}if(typeof el==="string"){el=document.querySelector(el)}if(!el){console.warn('No valid element provided');return this}var _obj=this;var evs={};var results,form;function search(s){str=s.toUpperCase();tmp=[];for(var i=0;i<opt.items.length;i+=1){datum={'rank':0,'key':i,'value':opt.items[i]};if(typeof opt.rank==="function"){datum.rank=opt.rank(opt.items[i],s)}else{if(opt.items[i].toUpperCase().indexOf(str)==0){datum.rank+=3}if(opt.items[i].toUpperCase().indexOf(str)>0){datum.rank+=1}}tmp.push(datum)}tmp=sortBy(tmp,'rank');if(!results){results=document.createElement('div');results.classList.add('typeahead-results');form.appendChild(results)}html="";if(tmp.length>0){var n=Math.min(tmp.length,(typeof opt.max==="number"?opt.max:10));html="<ol>";for(var i=0;i<n;i+=1){if(tmp[i].rank>0){html+='<li data-id="'+tmp[i].key+'" '+(i==0?' class="selected"':'')+'><a tabindex="0" href="#" class="name">'+(typeof opt.render==="function"?opt.render(opt.items[tmp[i].key]):opt.items[tmp[i].key])+"</a></li>"}}html+="</ol>"}results.innerHTML=html;var li=getLi();for(var i=0;i<li.length;i+=1){li[i].addEventListener('click',function(e){e.preventDefault();e.stopPropagation();el.value="";select(this.getAttribute('data-id'))})}return this}function getLi(){return results.querySelectorAll('li')}function select(i){if(i){if(typeof opt.process==="function"){opt.process.call(_obj,opt.items[i])}else{console.log(opt.items[i])}}results.innerHTML="";el.value="";return}function submit(){var li=getLi();var s=-1;for(var i=0;i<li.length;i+=1){if(li[i].classList.contains('selected')){return select(li[i].getAttribute('data-id'))}}return}function highlight(keyCode){var li=getLi();var s=-1;var sel;for(var i=0;i<li.length;i+=1){if(li[i].classList.contains('selected')){s=i}}sel=s;if(keyCode==40){s+=1}else{s-=1}if(s<0){s=li.length-1}if(s>=li.length){s=0}if(sel>=0){li[sel].classList.remove('selected')}li[s].classList.add('selected')}this.on=function(event,data,fn){if(!el){console.warn('Unable to attach event '+event);return this}if(event=="change"){if(!evs[event]){evs[event]=[];el.addEventListener('keyup',function(e){e.preventDefault();e.stopPropagation();if(e.keyCode==40||e.keyCode==38){highlight(e.keyCode)}else if(e.keyCode==13){submit()}else{t=event;search(this.value);if(evs[t]){e._typeahead=_obj;for(var i=0;i<evs[t].length;i+=1){ev=evs[t][i];e.data=ev.data||{};if(typeof ev.fn==="function"){ev.fn.call(this,e)}}}}})}evs[event].push({'fn':fn,'data':data})}else{console.warn('No event of type '+event)}return this};this.off=function(e,fn){if(evs[e]){for(var i=0;i<evs[e].length;i+=1){if(evs[e][i].fn==fn){evs[e].splice(i,1)}}}};if(el.parentElement.tagName=="FORM"){form=el.parentElement;form.addEventListener('submit',function(e){e.preventDefault();e.stopPropagation();submit()},false)}if(el){el.setAttribute('autocomplete','off')}this.on('change',{'test':'blah'},function(e){});return this}root.TypeAhead=new Builder();function sortBy(arr,i){yaxis=i;return arr.sort(function(a,b){return a[i]<b[i]?1:-1})}})(window||this);